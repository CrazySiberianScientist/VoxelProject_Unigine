// More information on ULON format - https://developer.unigine.com/docs/code/formats/ulon_format
// More information on scriptable materials - https://developer.unigine.com/docs/content/materials/scriptable
BaseMaterial <preview_hidden=1 var_prefix=var texture_prefix=tex>
{
	Texture2D screen_texture <source=procedural internal=true>
	
	Color my_color = [0.5 0.5 0.5 1.0]

	Int max_steps = 100
	Float max_dist = 100.0
	Float surface_dist = 0.1
	Float sphere_radius = 1.0
	
	Pass my_pass
	{
		Fragment =
		#{
			#include <core/materials/shaders/render/common.h>
			
			float sdfSphere2(float3 currentPos, float3 spherePos, float radius2)
			{
				return length2(spherePos - currentPos) - radius2;
			}

			INIT_STRUCTURED_BUFFER(0, float4, positions);

			STRUCT_FRAG_BEGIN
				INIT_COLOR(float4)
			STRUCT_FRAG_END
			
			MAIN_FRAG_BEGIN(FRAGMENT_IN)
				uint positionsNum;
				uint positionsStride;
				positions.GetDimensions(positionsNum, positionsStride);
				
				const float3 viewDirection = screenUVToViewDirection(IN_UV);

				float currentDistance = 0.0f;
				for (uint step = 0; step < var_max_steps; ++steps)
				{
					for (uint posIndex = 0; posIndex < positionsNum; ++posIndex)
					{

					}
				}

				/*
				for (uint i = 0; i < numStructs; ++i)
				{
					const float2 screenPos = positions[i].xy;
					const float length2Val = length2(IN_UV - screenPos);
					color = (length2Val > 0.001f) ? color : float4(0,1,0,1);
				}
				*/
				
				float4 color = TEXTURE_BIAS_ZERO(tex_screen_texture, IN_UV);

				OUT_COLOR = color;
			MAIN_FRAG_END
		#}
	}
}

